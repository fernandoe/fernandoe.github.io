<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Vagrant + Chef-Solo</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="Fernando Esp&#xED;ndola"></meta><meta name="description" content="Hands-on demonstration of vagrant and chef-solo"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="vagrant.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress"><div class="step" step="0" data-x="0" data-y="0"><h1 id="vagrant-and-chef-solo">Vagrant and Chef-Solo</h1><img src="images/vagrant-logo.gif" alt="" width="" height="250px"></img><img src="images/chef-logo.png" alt="" width="" height="250px"></img></div><div class="step" step="1" data-x="1100" data-y="0"><h1 id="painel-da-bolsa-project">Painel da Bolsa Project</h1><p>Demo: <a href="http://www.paineldabolsa.com.br">http://www.paineldabolsa.com.br</a></p><table cellpadding="0" cellspacing="0"><tbody><tr><td><img src="images/nginx-logo.jpg" alt="" width="300px" height=""></img></td><td><img src="images/redis-logo.png" alt="" width="300px" height=""></img></td></tr><tr><td><img src="images/python-logo.jpg" alt="" width="300px" height=""></img></td><td><img src="images/virtualenv-logo.gif" alt="" width="200px" height=""></img></td></tr><tr><td colspan="2"><img src="images/django-logo.png" alt="" width="300px" height=""></img></td></tr></tbody></table><p><a href="https://github.com/fernandoe/paineldabolsa-server">https://github.com/fernandoe/paineldabolsa-server</a></p><div class="notes"><p>git clone <a href="https://github.com/fernandoe/paineldabolsa-server">https://github.com/fernandoe/paineldabolsa-server</a></p></div></div><div class="step" step="2" data-x="2200" data-y="0"><h1 id="get-and-install-vagrant">Get and Install Vagrant</h1><img src="images/vagrant-install.png" alt="" width="" height="400px"></img><pre class="highlight code bash"><span class="nv">$ </span>vagrant --version
Vagrant 1.6.5</pre><p><a href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a></p><div class="notes"><ul><li>Check version: vagrant --version</li></ul></div></div><div class="step" step="3" data-x="3300" data-y="0"><h1 id="install-virtualbox">Install VirtualBox</h1><img src="images/virtualbox-logo.png" alt="" width="80px" height=""></img><img src="images/virtualbox-install.png" alt="" width="600px" height=""></img><pre class="highlight code bash"><span class="nv">$ </span>sudo apt-get install virtualbox

<span class="nv">$ </span>vboxmanage --version
4.3.10_Ubuntur93012</pre></div><div class="step" step="4" data-x="4400" data-y="0"><h1 id="project-setup">Project Setup</h1><pre class="highlight code bash"><span class="nv">$ </span>vagrant init</pre><p>This command will create a <em>Vagrant</em> file with the minimun required configuration.</p><div class="notes"><p>The primary function of the Vagrantfile is to describe the type of machine required for a project, and how to configure and provision these machines.</p><ul><li>Remove comments</li></ul><p>config.vm.box     = "precise64"</p><p>config.vm.box_url = "<a href="http://files.vagrantup.com/precise64.box">http://files.vagrantup.com/precise64.box</a>"</p></div></div><div class="step" step="5" data-x="5500" data-y="0"><h1 id="up-and-running">Up and Running</h1><pre class="highlight code bash"><span class="nv">$ </span>vagrant up</pre><img src="images/img-01.jpg" alt="" width="550px" height=""></img></div><div class="step" step="6" data-x="6600" data-y="0"><h1 id="other-commands">Other Commands</h1><pre class="highlight code bash"><span class="nv">$ </span>vagrant status
<span class="nv">$ </span>vagrant ssh
<span class="nv">$ </span>vagrant destroy</pre><img src="images/img-02.jpg" alt="" width="550px" height=""></img></div><div class="step" step="7" data-x="7700" data-y="0"><h1 id="vagrant-plugins">Vagrant Plugins</h1><p>Install the following plugins</p><pre class="highlight code bash"><span class="nv">$ </span>vagrant plugin install vagrant-omnibus
<span class="nv">$ </span>vagrant plugin install vagrant-proxyconf</pre><p>Add to the <em>Vagrantfile</em></p><pre class="highlight code ruby"><span class="c1"># config.omnibus.chef_version = :latest</span>
<span class="n">config</span><span class="o">.</span><span class="n">omnibus</span><span class="o">.</span><span class="n">chef_version</span> <span class="o">=</span> <span class="s2">"11.16.4"</span>

<span class="n">config</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">http</span>  <span class="o">=</span> <span class="s2">"http://proxy:port/"</span>
<span class="n">config</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="n">https</span> <span class="o">=</span> <span class="s2">"http://proxy:port/"</span></pre></div><div class="step" step="8" data-x="8800" data-y="0"><h1 id="provisioning">Provisioning</h1><blockquote><ul><li><strong>Chef (Chef-Solo)</strong></li><li>Puppet</li><li>Shell</li><li>Etc.</li></ul></blockquote><p><a href="https://docs.vagrantup.com/v2/provisioning/index.html">https://docs.vagrantup.com/v2/provisioning/index.html</a></p></div><div class="step" step="9" data-x="9900" data-y="0"><h1 id="chef-solo">Chef-Solo</h1><h2 id="cookbook">Cookbook</h2><blockquote><ul><li>unit of configuration for distribution</li><li>scenarios (components that are required)</li><li>Chef maintains a collection of cookbooks</li></ul></blockquote><p><a href="https://community.opscode.com/cookbooks-directory">https://community.opscode.com/cookbooks-directory</a></p></div><div class="step" step="10" data-x="9900" data-y="1100"><h1 id="id1">Chef-Solo</h1><h2 id="installation">Installation</h2><pre class="highlight code bash"><span class="c"># curl -L https://www.opscode.com/chef/install.sh | bash
# chef-solo --version
</span>Chef: 11.16.4</pre><img src="images/img-03.jpg" alt="" width="550px" height=""></img></div><div class="step" step="11" data-x="9900" data-y="2200"><h1 id="id2">Chef-Solo</h1><h2 id="initial-chef-configuration">Initial Chef Configuration</h2><pre class="highlight code bash"><span class="nv">$ </span>wget http://github.com/opscode/chef-repo/tarball/master
<span class="nv">$ </span>tar -zxf master
<span class="nv">$ </span>mv opscode-chef-repo* chef-repo
<span class="nv">$ </span>rm master</pre><div class="notes"><p>$ cd chef-repo</p><p>$ ls</p><p>Resource: <a href="http://gettingstartedwithchef.com/">http://gettingstartedwithchef.com/</a></p></div></div><div class="step" step="12" data-x="9900" data-y="3300"><h1 id="knife-configuration">Knife Configuration</h1><pre class="highlight code bash"><span class="nv">$ </span>mkdir .chef
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"cookbook_path [ 'cookbooks' ]"</span> &gt; .chef/knife.rb</pre><div class="notes"><ul><li>Add to the file: .chef/knife.rb<blockquote><ul><li>http_proxy "<a href="http://proxy:port">http://proxy:port</a>"</li><li>https_proxy "<a href="http://proxy:port">http://proxy:port</a>"</li></ul></blockquote></li></ul></div></div><div class="step" step="13" data-x="9900" data-y="4400"><h1 id="getting-cookbooks">Getting Cookbooks</h1><h2 id="our-first-chef-cookbook">Our first Chef cookbook</h2><h2 id="apt"><strong>apt</strong></h2><pre class="highlight code bash"><span class="nv">$ </span>knife cookbook site download apt
<span class="nv">$ </span>tar zxf apt*
<span class="nv">$ </span>rm apt*.tar.gz</pre></div><div class="step" step="14" data-x="9900" data-y="5500"><h1 id="id3">Getting Cookbooks</h1><h2 id="redis"><strong>redis</strong></h2><pre class="highlight code bash"><span class="nv">$ </span>knife cookbook site download redis
<span class="nv">$ </span>tar zxf redis*
<span class="nv">$ </span>rm redis*.tar.gz</pre></div><div class="step" step="15" data-x="9900" data-y="6600"><h1 id="id4">Getting Cookbooks</h1><h2 id="nginx"><strong>nginx</strong></h2><pre class="highlight code bash"><span class="nv">$ </span>knife cookbook site download nginx
<span class="nv">$ </span>tar zxf nginx*
<span class="nv">$ </span>rm nginx*.tar.gz</pre></div><div class="step" step="16" data-x="9900" data-y="7700"><h1 id="add-cookbooks-to-vagrant">Add Cookbooks to Vagrant</h1><pre class="highlight code ruby"><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:chef_solo</span> <span class="k">do</span> <span class="o">|</span><span class="n">chef</span><span class="o">|</span>
  <span class="n">chef</span><span class="o">.</span><span class="n">cookbooks_path</span> <span class="o">=</span> <span class="s2">"chef-repo/cookbooks"</span>
  <span class="n">chef</span><span class="o">.</span><span class="n">data_bags_path</span> <span class="o">=</span> <span class="s2">"chef-repo/data_bags"</span>
  <span class="n">chef</span><span class="o">.</span><span class="n">add_recipe</span> <span class="s2">"apt"</span>
  <span class="n">chef</span><span class="o">.</span><span class="n">add_recipe</span> <span class="s2">"redis::install_from_package"</span>
  <span class="n">chef</span><span class="o">.</span><span class="n">add_recipe</span> <span class="s2">"nginx"</span>
<span class="k">end</span></pre></div><div class="step" step="17" data-x="8800" data-y="7700"><h1 id="get-dependencies">Get Dependencies</h1><pre class="highlight code bash"><span class="c"># Dependencies for ...
</span><span class="nv">$ </span>knife cookbook site download runit
<span class="nv">$ </span>knife cookbook site download install_from
<span class="nv">$ </span>knife cookbook site download metachef
<span class="nv">$ </span>tar zxf runit*

<span class="c"># Dependencies for ...
</span><span class="nv">$ </span>knife cookbook site download build-essential
<span class="nv">$ </span>knife cookbook site download yum
<span class="nv">$ </span>knife cookbook site download yum-epel

<span class="c"># Dependencies for nginx
</span><span class="nv">$ </span>knife cookbook site download ohai
<span class="nv">$ </span>knife cookbook site download bluepill
<span class="nv">$ </span>knife cookbook site download rsyslog</pre></div><div class="step" step="18" data-x="7700" data-y="7700"><h1 id="synced-folders">Synced Folders</h1><pre class="highlight code ruby"><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">"."</span><span class="p">,</span> <span class="s2">"/vagrant"</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"vagrant-root"</span><span class="p">,</span> <span class="ss">disabled</span><span class="p">:</span> <span class="kp">true</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">"."</span><span class="p">,</span> <span class="s2">"/paineldabolsa"</span><span class="p">,</span> <span class="ss">create</span><span class="p">:</span> <span class="kp">true</span></pre><p><a href="https://docs.vagrantup.com/v2/synced-folders/basic_usage.html">https://docs.vagrantup.com/v2/synced-folders/basic_usage.html</a></p></div><div class="step" step="19" data-x="6600" data-y="7700"><h1 id="putting-it-all-together">Putting it all together</h1><pre class="highlight code bash"><span class="nv">$ </span>vagrant up</pre><img src="images/img-05.jpg" alt="" width="550px" height=""></img><div class="notes"><p>When used behind a proxy, you should press Ctrl+C and restart the process using vagrant reload.
#1 try: 10 minutes nd broke.</p></div></div><div class="step" step="20" data-x="5500" data-y="7700"><h1 id="providers">Providers</h1><p><a href="https://github.com/mohitsethi/vagrant-hp">https://github.com/mohitsethi/vagrant-hp</a></p><img src="images/hp-helion-logo.png" alt="" width="" height="130px"></img><p><a href="https://github.com/mitchellh/vagrant-aws">https://github.com/mitchellh/vagrant-aws</a></p><img src="images/aws-logo.png" alt="" width="" height="130px"></img></div><div class="step" step="21" data-x="4400" data-y="7700"><h1 id="provider-for-digital-ocean">Provider for Digital Ocean</h1></div><div class="step" step="22" data-x="3300" data-y="7700"><h1 id="questions">Questions?</h1><img src="images/img-04.jpg" alt="" width="550px" height=""></img></div><div class="step" step="23" data-x="3800" data-y="3800" data-scale="10" data-rotate-z="0" data-rotate-x="180" data-rotate-y="0" data-z="0"><h1 id="thank-you">Thank you!</h1><h2 id="fernando-espindola">Fernando Esp&#xED;ndola</h2><table cellpadding="0" cellspacing="0"><tbody><tr><td><img src="images/gmail-logo.jpg" alt="" width="" height="20px"></img></td><td><p><a href="mailto:fer.esp@gmail.com">fer.esp@gmail.com</a></p></td></tr><tr><td><img src="images/twitter-logo.jpg" alt="" width="" height="35px"></img></td><td><p><a href="https://twitter.com/feresp">@feresp</a></p></td></tr></tbody></table><h2 id="on-github">On Github</h2><p><a href="https://github.com/fernandoe/training-vagrant">https://github.com/fernandoe/training-vagrant</a>
<a href="https://github.com/fernandoe/paineldabolsa-server">https://github.com/fernandoe/paineldabolsa-server</a></p></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>